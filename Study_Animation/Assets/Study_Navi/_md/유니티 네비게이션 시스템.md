# 유니티 네비게이션 시스템

## 네비게이션 시스템이란?

유니티의 네비게이션 시스템은 AI 캐릭터가 목적지까지 **자동으로 경로를 탐색하고 이동할 수 있도록 지원하는 시스템**입니다. 이 시스템은 NavMesh(Navigation Mesh)를 기반으로 하며, 게임 환경의 지형과 장애물을 고려해 현실적인 이동을 구현할 수 있도록 도와줍니다.

---

## 유니티 네비게이션 시스템의 핵심 구성 요소

| 구성 요소           | 설명 |
|--------------------|------|
| **NavMesh**         | 이동 가능한 공간을 Bake하여 만들어진 메쉬 데이터. 에이전트는 이 경로 위를 이동함. |
| **NavMeshAgent**    | NavMesh 위를 따라 이동하는 AI 캐릭터에 부착되는 컴포넌트. 경로 탐색과 이동 제어를 담당. |
| **NavMeshObstacle** | 장애물 역할을 하며, Carve 옵션을 통해 실시간으로 경로를 차단하거나 유도할 수 있음. |
| **OffMeshLink**     | NavMesh로 연결되지 않은 구간(점프, 낙하 등)을 연결하는 특수 링크. |
| **NavMeshModifier / Volume** | 특정 영역의 탐색 비용, 통과 가능 여부 등을 제어함. 복수 Agent 지원에 필수적. |

---

## 작동 흐름 요약

### 전체 흐름:

1. **NavMesh Bake**
    - 바닥이나 지형 오브젝트를 `Navigation Static`으로 설정 후, Navigation 창에서 Bake 실행.
    - Agent Radius, Height, Slope, Step Height 등 설정값에 따라 이동 가능 지형이 결정됨.

2. **NavMeshAgent 부착**
    - AI 캐릭터(예: NPC, 몬스터)에 `NavMeshAgent` 컴포넌트를 부착.
    - 속성값(speed, acceleration 등)을 상황에 맞게 조정.

3. **목표 지점 설정**
    - `SetDestination(Vector3 position)` 함수를 통해 이동 목표 설정.
    - 사용자 입력, 플레이어 위치 추적, 랜덤 순찰 등 다양한 방식으로 제어 가능.

4. **경로 탐색 및 이동**
    - 유니티 내부의 A* 기반 알고리즘으로 최적 경로 계산 후 자동 이동.
    - 장애물이 있을 경우 실시간 경로 재계산 가능.

5. **장애물 회피 처리**
    - `NavMeshObstacle`이 경로를 차단하거나 우회 유도.
    - 움직이는 장애물의 경우 `Carve` 설정을 통해 동적으로 NavMesh에서 제외.

6. **특수 경로 연결 (OffMeshLink)**
    - 점프, 낙하 등 NavMesh가 끊긴 부분은 OffMeshLink를 통해 연결.
    - 애니메이션 또는 물리 연동으로 자연스러운 이동 구현 가능.

7. **이동 종료 및 다음 상태로 전환**
    - 목적지 도착 감지 (`agent.remainingDistance <= stoppingDistance`)
    - 이후 행동 상태 (예: 공격, 대기 등)로 전환 가능

---

## 활용 예시

1. **플레이어를 따라다니는 적 AI**
2. **마우스 클릭 지점으로 이동하는 캐릭터**
3. **맵을 순찰하는 경비병 NPC**
4. **건물 간을 자동으로 이동하는 주민 캐릭터**
5. **아이템을 줍기 위해 이동하는 서포트 AI**
6. **탈출구로 이동하는 좀비 무리**

---

## 한계점 및 고려 사항

| 한계 상황 | 설명 |
|-----------|------|
| **공중/비행 유닛 경로 탐색 불가** | NavMesh는 지면을 기준으로 생성되므로, 공중을 이동하는 유닛은 별도의 경로 탐색 알고리즘이 필요함. |
| **실시간 환경 변화 반영 어려움** | NavMesh는 정적 Bake가 기본이며, 맵이 실시간으로 변화하는 경우에는 NavMeshComponent나 Carve 기능을 사용해야 함. |
| **비정형 경로 이동 제한** | 예: 로프 타기, 벽 기어오르기 등은 OffMeshLink나 커스텀 구현이 필요. |
| **복잡한 지형 Bake 어려움** | 너무 좁거나 경사 심한 지형은 NavMesh가 생성되지 않거나 끊길 수 있음. 정확한 Bake 설정 필요. |
| **성능 문제** | 많은 Agent나 Obstacle이 동시에 움직이면 경로 재계산으로 인해 성능 저하 가능. 특히 Carving Obstacle은 주의. |
| **Agent 간 충돌 미지원** | 기본적으로 Agent는 서로를 피하지만 충돌 자체는 처리하지 않음. Rigidbody나 커스텀 충돌 로직이 필요함. |
| **장애물 우회 경로가 부자연스러움** | 너무 큰 Obstacle이나 좁은 통로에서는 이상한 경로를 선택할 수 있음. Modifier Volume 등을 이용해 경로 유도 필요. |
| **NavMeshObstacle이 지나치게 많을 경우 Bake 오류 발생** | NavMeshObstacle이 이동 중 Carving을 반복하면 NavMesh가 일시적으로 끊어져 경로 계산 실패 가능. |
| **복수 Agent 사용 시 경로 겹침 현상** | 여러 Agent가 같은 목표로 이동하면 겹쳐질 수 있음. 이동 지점을 약간 분산시키거나 local avoidance 시스템 필요. |
| **게임 씬 규모가 클 경우 NavMesh Bake 한계 존재** | 씬을 나누어 로딩하거나 NavMesh Streaming을 적용해야 성능 유지 가능. |

---

